<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Criteria API in Hibernate | Senthilkumar Gopal
</title>
  <link rel="canonical" href="https://sengopal.github.io/posts/criteria-api-in-hibernate.html">

    <link rel="apple-touch-icon" href="https://sengopal.github.io/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" type="image/png" href="https://sengopal.github.io/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://sengopal.github.io/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="https://sengopal.github.io/manifest.json">
    <meta name="theme-color" content="#333333">

  <link rel="stylesheet" href="https://sengopal.github.io/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://sengopal.github.io/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="https://sengopal.github.io/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://sengopal.github.io/theme/css/theme.css">
  <link rel="stylesheet" href="https://sengopal.github.io/extras/css/custom.css">
  <link rel="stylesheet" href="https://sengopal.github.io/extras/css/skylighting-solarized-theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://sengopal.github.io/feeds/all.atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://sengopal.github.io/feeds/java.atom.xml">
<meta name="description" content="A post about the Criteria API available as part of the Hibernate API. This post also explores how to use the API perform SQL operations in a more object oriented manner.">
  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o);
      a.async = 1;
      a.src = g;
      m = s.getElementsByTagName(o)[0];
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-67843911-1', 'auto');
    ga('send', 'pageview');
  </script>


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
  <div class="col-sm-12">
    <h1 class="title"><a href="https://sengopal.github.io/">Senthilkumar Gopal</a></h1>
      <p class="text-muted">Musings of a machine learning researcher, engineer and leader</p>
      <ul class="list-inline">
            <li class="list-inline-item"><a href="https://sengopal.github.io/pages/about.html">About me</a></li>
            <li class="list-inline-item"><a href="https://sengopal.github.io/pages/publications.html">Publications</a></li>
            <li class="list-inline-item"><a href="https://sengopal.github.io/pages/software.html">Software</a></li>
            <li class="list-inline-item"><a href="https://sengopal.github.io/pages/talks.html">Talks</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fas fa-rss" href="https://sengopal.github.io/feeds/all.atom.xml" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-github" href="https://github.com/sengopal" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-speaker-deck" href="https://speakerdeck.com/sengopal" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-medium" href="https://medium.com/@sengopal" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-twitter" href="https://twitter.com/@sengopal" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-linkedin" href="https://www.linkedin.com/in/senthilkumargopal" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>    Criteria API in Hibernate
</h1>
      <hr>
<article class="article">
    <header>
        <ul class="list-inline">
            <li class="list-inline-item text-muted" title="2008-05-30T00:00:00-07:00">
                <i class="fas fa-clock"></i>
                Fri 30 May 2008
            </li>
            <li class="list-inline-item">
                <i class="fas fa-folder-open"></i>
                <a href="https://sengopal.github.io/category/java.html">Java</a>
            </li>
            <li class="list-inline-item">
                <i class="fas fa-tag"></i>
                <a href="https://sengopal.github.io/tag/development.html">#development</a>,                 <a href="https://sengopal.github.io/tag/coding.html">#coding</a>            </li>
        </ul>
    </header>
    <div class="hidden-xs hidden-sm">
        <div id="toc"><ul><li><a class="toc-href" href="#drawbacks-of-hql" title="Drawbacks of HQL">Drawbacks of HQL</a></li><li><a class="toc-href" href="#what-is-criteria-api" title="What is Criteria API?">What is Criteria API?</a></li><li><a class="toc-href" href="#order-interface" title="Order Interface">Order Interface</a></li><li><a class="toc-href" href="#simple-criteria-query" title="Simple Criteria Query">Simple Criteria Query</a></li><li><a class="toc-href" href="#criterion-chaining" title="Criterion Chaining">Criterion Chaining</a></li><li><a class="toc-href" href="#restriction-for-where-property" title="Restriction for WHERE
property">Restriction for WHERE
property</a></li><li><a class="toc-href" href="#disjunction-and-conjunction" title="Disjunction and Conjunction:">Disjunction and Conjunction:</a></li><li><a class="toc-href" href="#how-to-join-tables-using-criteria-api" title="How to join Tables using
Criteria API">How to join Tables using
Criteria API</a></li><li><a class="toc-href" href="#projections---aggregation-and-grouping" title="Projections -
Aggregation and Grouping">Projections -
Aggregation and Grouping</a></li><li><a class="toc-href" href="#query-by-example-api" title="Query By Example API">Query By Example API</a></li></ul></div>
    </div>
    <div class="content">
        <h3 id="drawbacks-of-hql">Drawbacks of HQL</h3>
<p>Currently HQL (Hibernate Query Language) is used widely to query data
using Hibernate. However, there are many drawbacks such as:</p>
<ol type="1">
<li>SQL-like syntax and Non Extensible</li>
<li>Relational methodology instead of OO methodology</li>
<li>Problem in creating search queries on the fly</li>
<li>Complexity increases with number of variable conditions</li>
<li>Error-prone String concatenation</li>
<li>Direct use of query parameters in the query string</li>
</ol>
<p>A sample usage for HQL Query:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a aria-hidden="true" href="#cb1-1" tabindex="-1"></a><span class="bu">String</span> query <span class="op">=</span> <span class="st">"select o from Order as o join o.products as p where o.priceTotal &gt; :priceTotalLower and o.priceTotal &lt; :priceTotalUpper"</span><span class="op">;</span>           </span>
<span id="cb1-2"><a aria-hidden="true" href="#cb1-2" tabindex="-1"></a><span class="bu">Query</span> q <span class="op">=</span> sess<span class="op">.</span><span class="fu">createQuery</span><span class="op">(</span>query<span class="op">);</span></span>
<span id="cb1-3"><a aria-hidden="true" href="#cb1-3" tabindex="-1"></a>q<span class="op">.</span><span class="fu">setDouble</span><span class="op">(</span><span class="st">"priceTotalLower"</span><span class="op">,</span> <span class="bu">Double</span><span class="op">.</span><span class="fu">parseDouble</span><span class="op">(</span>lower<span class="op">));</span></span>
<span id="cb1-4"><a aria-hidden="true" href="#cb1-4" tabindex="-1"></a>q<span class="op">.</span><span class="fu">setDouble</span><span class="op">(</span><span class="st">"priceTotalUpper"</span><span class="op">,</span><span class="bu">Double</span><span class="op">.</span><span class="fu">parseDouble</span><span class="op">(</span>upper<span class="op">));</span></span>
<span id="cb1-5"><a aria-hidden="true" href="#cb1-5" tabindex="-1"></a><span class="bu">List</span> list <span class="op">=</span> q<span class="op">.</span><span class="fu">list</span><span class="op">();</span></span></code></pre></div>
<p>In comparison to the Criteria API, the above query gets reduced to
simple two lines with more comprehension and understanding of the
functionality.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a aria-hidden="true" href="#cb2-1" tabindex="-1"></a><span class="bu">List</span> list <span class="op">=</span> sess<span class="op">.</span><span class="fu">createCriteria</span><span class="op">(</span>Order<span class="op">.</span><span class="fu">class</span><span class="op">)</span></span>
<span id="cb2-2"><a aria-hidden="true" href="#cb2-2" tabindex="-1"></a><span class="op">.</span><span class="fu">add</span><span class="op">(</span>Restrictions<span class="op">.</span><span class="fu">between</span><span class="op">(</span>lower<span class="op">,</span>upper<span class="op">).</span><span class="fu">list</span><span class="op">();</span></span></code></pre></div>
<p>In addition to the conciseness and readability, following are some of
the best parts of using the Criteria API</p>
<ol type="1">
<li>Aspects of the relational approach</li>
<li>Reduces the complexity</li>
<li>Multi-criteria search functionalities</li>
<li>Building Hibernate Queries on the fly</li>
<li>Knowledge of SQL not necessary</li>
<li><strong>Extensible</strong> since it uses OO methodology</li>
<li><strong>Interoperable</strong> since it has provision for including
native SQL clauses also</li>
<li>Rich set of comparison operators</li>
<li>Business Objects as query parameters, without having to use primary
and foreign key references</li>
<li>Optimizing queries by providing various JOIN Strategies</li>
<li>Provides cleaner, clearer, more reliable and more maintainable
code.</li>
</ol>
<h3 id="what-is-criteria-api">What is Criteria API?</h3>
<p>There are five core components of the Criteria API.</p>
<ol type="1">
<li>Criteria</li>
<li>Criterion</li>
<li>Restrictions</li>
<li>Projection</li>
<li>Order</li>
</ol>
<p>Criteria class provides the gateway to working with criteria APIs.
Criterion class is the object-oriented representation of the relational
criterion. Restriction API provides the built-in types for Criterion.
Essentially, the Restriction class is a factory to the Criterion class.
All of its methods are static.</p>
<p>In Hibernate 2.x, the Expression class provided the services that are
now provided by the Restriction class. The Restriction class provides
almost all the required restrictions such as equals (eq()), logical and
(and()), like (like()) Aggregation and Grouping are provided by the
Projection class. Order class represents the &ldquo;order by&rdquo; clause of
SQL.</p>
<h3 id="order-interface">Order Interface</h3>
<p>In HQL (and SQL), the order by clause allows you to order your query
results. This is done using the addOrder() method and the Order class
The SQL will have the order clause in the sequence the Order objects
were added to the Critieria.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a aria-hidden="true" href="#cb3-1" tabindex="-1"></a>Criteria crit <span class="op">=</span> session<span class="op">.</span><span class="fu">createCriteria</span><span class="op">(</span>Sale<span class="op">.</span><span class="fu">class</span><span class="op">)</span> <span class="op">;</span></span>
<span id="cb3-2"><a aria-hidden="true" href="#cb3-2" tabindex="-1"></a>crit<span class="op">.</span><span class="fu">addOrder</span><span class="op">(</span> Order<span class="op">.</span><span class="fu">desc</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span> <span class="op">);</span></span>
<span id="cb3-3"><a aria-hidden="true" href="#cb3-3" tabindex="-1"></a>crit<span class="op">.</span><span class="fu">addOrder</span><span class="op">(</span> Order<span class="op">.</span><span class="fu">asc</span><span class="op">(</span><span class="st">"product.number"</span><span class="op">)</span> <span class="op">);</span></span></code></pre></div>
<h3 id="simple-criteria-query">Simple Criteria Query</h3>
<p>The following code shows how a simple Criteria query is built.</p>
<ol type="1">
<li>It selects the Insurance Object</li>
<li>Includes a Where clause insurance name like &lsquo;%a%&rsquo;</li>
<li>Includes another Where clause investmentAmount value between 1000
and 2500 inclusive</li>
<li>Sets the number of maximum results as 5</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a aria-hidden="true" href="#cb4-1" tabindex="-1"></a>session <span class="op">=</span> sessionFactory<span class="op">.</span><span class="fu">openSession</span><span class="op">();</span></span>
<span id="cb4-2"><a aria-hidden="true" href="#cb4-2" tabindex="-1"></a>Criteria crit <span class="op">=</span> session<span class="op">.</span><span class="fu">createCriteria</span><span class="op">(</span>Insurance<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb4-3"><a aria-hidden="true" href="#cb4-3" tabindex="-1"></a>crit<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Restrictions<span class="op">.</span><span class="fu">like</span><span class="op">(</span><span class="st">"insuranceName"</span><span class="op">,</span> <span class="st">"%a%"</span><span class="op">));</span> </span>
<span id="cb4-4"><a aria-hidden="true" href="#cb4-4" tabindex="-1"></a>crit<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="bu">Expression</span><span class="op">.</span><span class="fu">between</span><span class="op">(</span><span class="st">"investAmount"</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Integer</span><span class="op">(</span><span class="dv">1000</span><span class="op">),</span><span class="kw">new</span> <span class="bu">Integer</span><span class="op">(</span><span class="dv">2500</span><span class="op">)));</span> </span>
<span id="cb4-5"><a aria-hidden="true" href="#cb4-5" tabindex="-1"></a>crit<span class="op">.</span><span class="fu">setMaxResults</span><span class="op">(</span><span class="dv">5</span><span class="op">);</span> </span>
<span id="cb4-6"><a aria-hidden="true" href="#cb4-6" tabindex="-1"></a><span class="bu">List</span> insurances <span class="op">=</span> crit<span class="op">.</span><span class="fu">list</span><span class="op">();</span></span>
<span id="cb4-7"><a aria-hidden="true" href="#cb4-7" tabindex="-1"></a><span class="cf">for</span><span class="op">(</span><span class="bu">Iterator</span> it <span class="op">=</span>insurances<span class="op">.</span><span class="fu">iterator</span><span class="op">();</span>it<span class="op">.</span><span class="fu">hasNext</span><span class="op">();){</span></span>
<span id="cb4-8"><a aria-hidden="true" href="#cb4-8" tabindex="-1"></a>    Insurance insurance <span class="op">=</span> <span class="op">(</span>Insurance<span class="op">)</span> it<span class="op">.</span><span class="fu">next</span><span class="op">();</span></span>
<span id="cb4-9"><a aria-hidden="true" href="#cb4-9" tabindex="-1"></a>  <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"ID: "</span> <span class="op">+</span> insurance<span class="op">.</span><span class="fu">getLngInsuranceId</span><span class="op">());</span></span>
<span id="cb4-10"><a aria-hidden="true" href="#cb4-10" tabindex="-1"></a>  <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"Name: "</span> <span class="op">+</span> insurance<span class="op">.</span><span class="fu">getInsuranceName</span><span class="op">());</span></span>
<span id="cb4-11"><a aria-hidden="true" href="#cb4-11" tabindex="-1"></a>  <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"Amount: "</span> <span class="op">+</span> insurance<span class="op">.</span><span class="fu">getInvestAmount</span><span class="op">());</span></span>
<span id="cb4-12"><a aria-hidden="true" href="#cb4-12" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="criterion-chaining">Criterion Chaining</h3>
<p>This is a popular method of adding Restrictions, Expressions,
Projections and Order object without the need to create additional
Objects. This is particularly useful when the Criteria Objects which are
extensible are needed to be passed between methods.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a aria-hidden="true" href="#cb5-1" tabindex="-1"></a><span class="bu">List</span> sales <span class="op">=</span> session<span class="op">.</span><span class="fu">createCriteria</span><span class="op">(</span>Sale<span class="op">.</span><span class="fu">class</span><span class="op">)</span></span>
<span id="cb5-2"><a aria-hidden="true" href="#cb5-2" tabindex="-1"></a>    <span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="bu">Expression</span><span class="op">.</span><span class="fu">ge</span><span class="op">(</span><span class="st">"date"</span><span class="op">,</span>startDate<span class="op">)</span></span>
<span id="cb5-3"><a aria-hidden="true" href="#cb5-3" tabindex="-1"></a>    <span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="bu">Expression</span><span class="op">.</span><span class="fu">le</span><span class="op">(</span><span class="st">"date"</span><span class="op">,</span>endDate<span class="op">)</span></span>
<span id="cb5-4"><a aria-hidden="true" href="#cb5-4" tabindex="-1"></a>    <span class="op">.</span><span class="fu">addOrder</span><span class="op">(</span> Order<span class="op">.</span><span class="fu">asc</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span> <span class="op">)</span></span>
<span id="cb5-5"><a aria-hidden="true" href="#cb5-5" tabindex="-1"></a>    <span class="op">.</span><span class="fu">setFirstResult</span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb5-6"><a aria-hidden="true" href="#cb5-6" tabindex="-1"></a>    <span class="op">.</span><span class="fu">setMaxResults</span><span class="op">(</span><span class="dv">10</span><span class="op">)</span></span>
<span id="cb5-7"><a aria-hidden="true" href="#cb5-7" tabindex="-1"></a>    <span class="op">.</span><span class="fu">list</span><span class="op">();</span></span></code></pre></div>
<h3 id="restriction-for-where-property">Restriction for WHERE
property</h3>
<p>The WHERE clause or <em>Restrictions</em> can be easily applied via
<code>Restriction.eqProperty()</code>,
<code>Restriction.neProperty()</code>,
<code>Restriction.leProperty()</code> and
<code>Restriction.geProperty()</code></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a aria-hidden="true" href="#cb6-1" tabindex="-1"></a><span class="co">// Adds a WHERE Clause for comparing two columns,</span></span>
<span id="cb6-2"><a aria-hidden="true" href="#cb6-2" tabindex="-1"></a>session<span class="op">.</span><span class="fu">createCriteria</span><span class="op">(</span>Sale<span class="op">.</span><span class="fu">class</span><span class="op">)</span></span>
<span id="cb6-3"><a aria-hidden="true" href="#cb6-3" tabindex="-1"></a>    <span class="op">.</span><span class="fu">eqProperty</span><span class="op">(</span><span class="st">"saleDate"</span><span class="op">,</span><span class="st">"releaseDate"</span><span class="op">)</span></span>
<span id="cb6-4"><a aria-hidden="true" href="#cb6-4" tabindex="-1"></a>    <span class="op">.</span><span class="fu">list</span><span class="op">();</span></span></code></pre></div>
<p>Restriction still allows custom restrictions added using
<code>Restrictions.sqlRestriction</code></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a aria-hidden="true" href="#cb7-1" tabindex="-1"></a><span class="co">// Adds a native SQL Restriction in the WHERE Clause</span></span>
<span id="cb7-2"><a aria-hidden="true" href="#cb7-2" tabindex="-1"></a>sess<span class="op">.</span><span class="fu">createCriteria</span><span class="op">(</span>Cat<span class="op">.</span><span class="fu">class</span><span class="op">)</span></span>
<span id="cb7-3"><a aria-hidden="true" href="#cb7-3" tabindex="-1"></a><span class="op">.</span><span class="fu">add</span><span class="op">(</span>Restrictions<span class="op">.</span><span class="fu">sqlRestriction</span><span class="op">(</span><span class="st">"lower({alias}.name) like lower(?)"</span><span class="op">,</span> <span class="st">"Fritz%"</span><span class="op">,</span>Hibernate<span class="op">.</span><span class="fu">STRING</span><span class="op">)</span> <span class="op">)</span> <span class="op">.</span><span class="fu">list</span><span class="op">();</span></span></code></pre></div>
<p><em>All the static methods available in Restrictions are also
available in the Expression API. Also it contains some additional
methods such as ilike(&ldquo;columnname&rdquo;) which does a lower(columnname) in
the query.</em></p>
<h3 id="disjunction-and-conjunction">Disjunction and Conjunction:</h3>
<p>Disjunction and Conjunction are excellent APIs which help perform
complex search criteria simple to develop and maintain.</p>
<p><strong>Disjunction</strong> indicates a group of Criterion to be
<strong>ORed</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a aria-hidden="true" href="#cb8-1" tabindex="-1"></a>Disjunction disList <span class="op">=</span> Restrictions<span class="op">.</span><span class="fu">disjunction</span><span class="op">();</span></span>
<span id="cb8-2"><a aria-hidden="true" href="#cb8-2" tabindex="-1"></a>disList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Restrictions<span class="op">.</span><span class="fu">eq</span><span class="op">(</span><span class="st">"id"</span><span class="op">,</span><span class="kw">new</span> <span class="bu">Integer</span><span class="op">(</span><span class="dv">1</span><span class="op">));</span></span>
<span id="cb8-3"><a aria-hidden="true" href="#cb8-3" tabindex="-1"></a>disList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Restrictions<span class="op">.</span><span class="fu">eq</span><span class="op">(</span><span class="st">"id"</span><span class="op">,</span><span class="kw">new</span> <span class="bu">Integer</span><span class="op">(</span><span class="dv">2</span><span class="op">));</span></span>
<span id="cb8-4"><a aria-hidden="true" href="#cb8-4" tabindex="-1"></a>sess<span class="op">.</span><span class="fu">createCriteria</span><span class="op">(</span>Cat<span class="op">.</span><span class="fu">class</span><span class="op">)</span> <span class="op">.</span><span class="fu">add</span><span class="op">(</span>disList<span class="op">);</span></span>
<span id="cb8-5"><a aria-hidden="true" href="#cb8-5" tabindex="-1"></a><span class="co">// This gives the WHERE Clause WHERE (id=1 OR id=2)</span></span></code></pre></div>
<p><strong>Conjunction</strong> indicates a group of Critierion to be
<strong>ANDed</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a aria-hidden="true" href="#cb9-1" tabindex="-1"></a>Conjunction conList <span class="op">=</span> Restrictions<span class="op">.</span><span class="fu">conjunction</span><span class="op">();</span></span>
<span id="cb9-2"><a aria-hidden="true" href="#cb9-2" tabindex="-1"></a>conList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Restrictions<span class="op">.</span><span class="fu">eq</span><span class="op">(</span><span class="st">"id"</span><span class="op">,</span><span class="kw">new</span> <span class="bu">Integer</span><span class="op">(</span><span class="dv">1</span><span class="op">));</span></span>
<span id="cb9-3"><a aria-hidden="true" href="#cb9-3" tabindex="-1"></a>conList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Restrictions<span class="op">.</span><span class="fu">eq</span><span class="op">(</span><span class="st">"id"</span><span class="op">,</span><span class="kw">new</span> <span class="bu">Integer</span><span class="op">(</span><span class="dv">2</span><span class="op">));</span></span>
<span id="cb9-4"><a aria-hidden="true" href="#cb9-4" tabindex="-1"></a>sess<span class="op">.</span><span class="fu">createCriteria</span><span class="op">(</span>Cat<span class="op">.</span><span class="fu">class</span><span class="op">)</span> <span class="op">.</span><span class="fu">add</span><span class="op">(</span>conList<span class="op">);</span></span>
<span id="cb9-5"><a aria-hidden="true" href="#cb9-5" tabindex="-1"></a><span class="co">// This gives the WHERE Clause WHERE (id=1 AND id=2)</span></span></code></pre></div>
<p>_The Disjunctions and Conjunctions can be nested as well and also
along with group of Restrictions.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb10-1"><a aria-hidden="true" href="#cb10-1" tabindex="-1"></a>Conjunction conList <span class="op">=</span> Restrictions<span class="op">.</span><span class="fu">conjunction</span><span class="op">();</span></span>
<span id="cb10-2"><a aria-hidden="true" href="#cb10-2" tabindex="-1"></a>conList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Restrictions<span class="op">.</span><span class="fu">disjunction</span><span class="op">()</span></span>
<span id="cb10-3"><a aria-hidden="true" href="#cb10-3" tabindex="-1"></a>       <span class="op">.</span><span class="fu">add</span><span class="op">(</span>Restrictions<span class="op">.</span><span class="fu">eq</span><span class="op">(</span><span class="st">"id"</span><span class="op">,</span><span class="kw">new</span> <span class="bu">Integer</span><span class="op">(</span><span class="dv">1</span><span class="op">))));</span></span></code></pre></div>
<h3 id="how-to-join-tables-using-criteria-api">How to join Tables using
Criteria API</h3>
<p>Using HQLs, joins resemble SQL closely. [source,sql]</p>
<pre><code>// use LEFT JOIN FETCH for optimizing queries
from Sale sale where sale.date &gt; :startDate left join fetch sale.product</code></pre>
<p>The same can be achieved using Criteria API with the help of
<code>setFetchMode()</code></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb12-1"><a aria-hidden="true" href="#cb12-1" tabindex="-1"></a>session<span class="op">.</span><span class="fu">createCriteria</span><span class="op">(</span>Sale<span class="op">.</span><span class="fu">class</span><span class="op">)</span></span>
<span id="cb12-2"><a aria-hidden="true" href="#cb12-2" tabindex="-1"></a>      <span class="op">.</span><span class="fu">setFetchMode</span><span class="op">(</span><span class="st">"product"</span><span class="op">,</span>FetchMode<span class="op">.</span><span class="fu">EAGER</span><span class="op">)</span></span>
<span id="cb12-3"><a aria-hidden="true" href="#cb12-3" tabindex="-1"></a>      <span class="op">.</span><span class="fu">setFetchMode</span><span class="op">(</span><span class="st">"category"</span><span class="op">,</span>FetchMode<span class="op">.</span><span class="fu">EAGER</span><span class="op">)</span></span>
<span id="cb12-4"><a aria-hidden="true" href="#cb12-4" tabindex="-1"></a>      <span class="op">.</span><span class="fu">list</span><span class="op">();</span></span></code></pre></div>
<p>Using Criteria API, even <strong>Restriction</strong> can be applied
on the joined tables.Criteria API uses the createCriteria() or
createAlias() (no new instance) to create an inner join between the two
tables.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb13-1"><a aria-hidden="true" href="#cb13-1" tabindex="-1"></a><span class="co">// to find all the shirt models with sizes over 40.</span></span>
<span id="cb13-2"><a aria-hidden="true" href="#cb13-2" tabindex="-1"></a><span class="co">// HQL: from Shirt shirt join shirt.availableSizes size where size.number &gt; 40</span></span>
<span id="cb13-3"><a aria-hidden="true" href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a aria-hidden="true" href="#cb13-4" tabindex="-1"></a>Session<span class="op">.</span><span class="fu">createCriteria</span><span class="op">(</span>Shirt<span class="op">.</span><span class="fu">class</span><span class="op">)</span></span>
<span id="cb13-5"><a aria-hidden="true" href="#cb13-5" tabindex="-1"></a>      <span class="op">.</span><span class="fu">createCriteria</span><span class="op">(</span><span class="st">"availableSizes"</span><span class="op">)</span></span>
<span id="cb13-6"><a aria-hidden="true" href="#cb13-6" tabindex="-1"></a>      <span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="bu">Expression</span><span class="op">.</span><span class="fu">gt</span><span class="op">(</span><span class="st">"number"</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Integer</span><span class="op">(</span><span class="dv">40</span><span class="op">)))</span></span>
<span id="cb13-7"><a aria-hidden="true" href="#cb13-7" tabindex="-1"></a>      <span class="op">.</span><span class="fu">list</span><span class="op">();</span></span></code></pre></div>
<h3 id="projections---aggregation-and-grouping">Projections -
Aggregation and Grouping</h3>
<p>The Projections API is used for aggregation and grouping
functionality. A simple example which returns the count of number of
cats with age greater than 10.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a aria-hidden="true" href="#cb14-1" tabindex="-1"></a><span class="co">// Simple Projection</span></span>
<span id="cb14-2"><a aria-hidden="true" href="#cb14-2" tabindex="-1"></a>session<span class="op">.</span><span class="fu">createCriteria</span><span class="op">(</span>Cat<span class="op">.</span><span class="fu">class</span><span class="op">)</span></span>
<span id="cb14-3"><a aria-hidden="true" href="#cb14-3" tabindex="-1"></a>      <span class="op">.</span><span class="fu">add</span><span class="op">(</span>Restrictions<span class="op">.</span><span class="fu">gt</span><span class="op">(</span><span class="st">"age"</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Integer</span><span class="op">(</span><span class="dv">10</span><span class="op">))</span></span>
<span id="cb14-4"><a aria-hidden="true" href="#cb14-4" tabindex="-1"></a>      <span class="op">.</span><span class="fu">setProjection</span><span class="op">(</span>Projections<span class="op">.</span><span class="fu">rowCount</span><span class="op">())</span></span>
<span id="cb14-5"><a aria-hidden="true" href="#cb14-5" tabindex="-1"></a>      <span class="op">.</span><span class="fu">list</span><span class="op">();</span></span></code></pre></div>
<p>A number of aggregations can be done in a single Criteria and can be
done along with a group by clause.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb15-1"><a aria-hidden="true" href="#cb15-1" tabindex="-1"></a>Criteria crit <span class="op">=</span> session<span class="op">.</span><span class="fu">createCriteria</span><span class="op">(</span>Cat<span class="op">.</span><span class="fu">class</span><span class="op">)</span></span>
<span id="cb15-2"><a aria-hidden="true" href="#cb15-2" tabindex="-1"></a>ProjectionList projList <span class="op">=</span> Projections<span class="op">.</span><span class="fu">projectionList</span><span class="op">();</span></span>
<span id="cb15-3"><a aria-hidden="true" href="#cb15-3" tabindex="-1"></a>projList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Projections<span class="op">.</span><span class="fu">rowCount</span><span class="op">()</span> <span class="op">);</span></span>
<span id="cb15-4"><a aria-hidden="true" href="#cb15-4" tabindex="-1"></a>projList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Projections<span class="op">.</span><span class="fu">avg</span><span class="op">(</span><span class="st">"weight"</span><span class="op">)</span> <span class="op">)</span> <span class="op">;</span></span>
<span id="cb15-5"><a aria-hidden="true" href="#cb15-5" tabindex="-1"></a>projList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Projections<span class="op">.</span><span class="fu">max</span><span class="op">(</span><span class="st">"weight"</span><span class="op">)</span> <span class="op">)</span> <span class="op">;</span></span>
<span id="cb15-6"><a aria-hidden="true" href="#cb15-6" tabindex="-1"></a>projList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Projections<span class="op">.</span><span class="fu">groupProperty</span><span class="op">(</span><span class="st">"color"</span><span class="op">)</span> <span class="op">)</span> ) <span class="op">;</span></span>
<span id="cb15-7"><a aria-hidden="true" href="#cb15-7" tabindex="-1"></a><span class="bu">List</span> result <span class="op">=</span> crit<span class="op">.</span><span class="fu">setProjection</span><span class="op">(</span>projList<span class="op">).</span><span class="fu">list</span><span class="op">();</span></span></code></pre></div>
<p>To allow the users to query only the required columns Hibernate 3
introduced the <strong>Projections.property()</strong></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb16-1"><a aria-hidden="true" href="#cb16-1" tabindex="-1"></a>Criteria crit <span class="op">=</span> session<span class="op">.</span><span class="fu">createCriteria</span><span class="op">(</span>Employee<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb16-2"><a aria-hidden="true" href="#cb16-2" tabindex="-1"></a>crit<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Restrictions<span class="op">.</span><span class="fu">eq</span><span class="op">(</span><span class="st">"zipCode"</span><span class="op">,</span> zipCode<span class="op">));</span></span>
<span id="cb16-3"><a aria-hidden="true" href="#cb16-3" tabindex="-1"></a>crit<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Restrictions<span class="op">.</span><span class="fu">gt</span><span class="op">(</span><span class="st">"salary"</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Integer</span><span class="op">(</span><span class="dv">10000</span><span class="op">));</span></span>
<span id="cb16-4"><a aria-hidden="true" href="#cb16-4" tabindex="-1"></a>ProjectionList projList <span class="op">=</span> Projections<span class="op">.</span><span class="fu">projectionList</span><span class="op">();</span></span>
<span id="cb16-5"><a aria-hidden="true" href="#cb16-5" tabindex="-1"></a>projList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Projections<span class="op">.</span><span class="fu">property</span><span class="op">(</span><span class="st">"name"</span><span class="op">));</span></span>
<span id="cb16-6"><a aria-hidden="true" href="#cb16-6" tabindex="-1"></a>projList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Projections<span class="op">.</span><span class="fu">property</span><span class="op">(</span><span class="st">"age"</span><span class="op">));</span></span>
<span id="cb16-7"><a aria-hidden="true" href="#cb16-7" tabindex="-1"></a>projList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Projections<span class="op">.</span><span class="fu">property</span><span class="op">(</span><span class="st">"county"</span><span class="op">));</span></span>
<span id="cb16-8"><a aria-hidden="true" href="#cb16-8" tabindex="-1"></a>projList<span class="op">.</span><span class="fu">add</span><span class="op">(</span>Projections<span class="op">.</span><span class="fu">property</span><span class="op">(</span><span class="st">"job"</span><span class="op">));</span></span>
<span id="cb16-9"><a aria-hidden="true" href="#cb16-9" tabindex="-1"></a>crit<span class="op">.</span><span class="fu">setProjection</span><span class="op">(</span>projList<span class="op">);</span></span></code></pre></div>
<p><em>This really helps when the table being queried contains 50 to 60
columns and we need only 4 to 5 columns.</em></p>
<h3 id="query-by-example-api">Query By Example API</h3>
<p>The Example API helps to optimize the query by initializing the text
values and by providing extensibility of the Criterion Object.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb17-1"><a aria-hidden="true" href="#cb17-1" tabindex="-1"></a><span class="co">// Initializing the text values to be used</span></span>
<span id="cb17-2"><a aria-hidden="true" href="#cb17-2" tabindex="-1"></a>Accommodation accommodationEx <span class="op">=</span> <span class="kw">new</span> <span class="fu">Accommodation</span><span class="op">();</span></span>
<span id="cb17-3"><a aria-hidden="true" href="#cb17-3" tabindex="-1"></a>accommodationEx<span class="op">.</span><span class="fu">setCountry</span><span class="op">(</span>country<span class="op">);</span> </span>
<span id="cb17-4"><a aria-hidden="true" href="#cb17-4" tabindex="-1"></a>accommodationEx<span class="op">.</span><span class="fu">setCapacity</span><span class="op">(</span>capacity<span class="op">);</span></span>
<span id="cb17-5"><a aria-hidden="true" href="#cb17-5" tabindex="-1"></a></span>
<span id="cb17-6"><a aria-hidden="true" href="#cb17-6" tabindex="-1"></a><span class="co">// Creating and fine tuning the example object</span></span>
<span id="cb17-7"><a aria-hidden="true" href="#cb17-7" tabindex="-1"></a>Example example <span class="op">=</span> Example<span class="op">.</span><span class="fu">create</span><span class="op">(</span>accommodationEx<span class="op">)</span></span>
<span id="cb17-8"><a aria-hidden="true" href="#cb17-8" tabindex="-1"></a>    <span class="op">.</span><span class="fu">ignoreCase</span><span class="op">()</span> <span class="co">//Queries are case insensitive</span></span>
<span id="cb17-9"><a aria-hidden="true" href="#cb17-9" tabindex="-1"></a>    <span class="op">.</span><span class="fu">excludeZeroes</span><span class="op">()</span>  <span class="co">//zero-valued fields are ignored</span></span>
<span id="cb17-10"><a aria-hidden="true" href="#cb17-10" tabindex="-1"></a>    <span class="op">.</span><span class="fu">excludeProperty</span><span class="op">(</span><span class="st">"doNotUse"</span><span class="op">)</span> <span class="co">// this property is excluded</span></span>
<span id="cb17-11"><a aria-hidden="true" href="#cb17-11" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enableLike</span><span class="op">(</span>MatchMode<span class="op">.</span><span class="fu">ANYWHERE</span><span class="op">);</span> <span class="co">//query string matching uses &lsquo;%X%&rsquo;</span></span>
<span id="cb17-12"><a aria-hidden="true" href="#cb17-12" tabindex="-1"></a></span>
<span id="cb17-13"><a aria-hidden="true" href="#cb17-13" tabindex="-1"></a><span class="co">// Using the Example Object and adding further restrictions</span></span>
<span id="cb17-14"><a aria-hidden="true" href="#cb17-14" tabindex="-1"></a><span class="bu">List</span> list <span class="op">=</span> session<span class="op">.</span><span class="fu">createCriteria</span><span class="op">(</span>Accommodation<span class="op">.</span><span class="fu">class</span><span class="op">)</span></span>
<span id="cb17-15"><a aria-hidden="true" href="#cb17-15" tabindex="-1"></a>    <span class="op">.</span><span class="fu">add</span><span class="op">(</span>example<span class="op">)</span></span>
<span id="cb17-16"><a aria-hidden="true" href="#cb17-16" tabindex="-1"></a>    <span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="bu">Expression</span><span class="op">.</span><span class="fu">between</span><span class="op">(</span><span class="st">"availabilityDate"</span><span class="op">,</span> startDate<span class="op">,</span> endDate<span class="op">))</span></span>
<span id="cb17-17"><a aria-hidden="true" href="#cb17-17" tabindex="-1"></a>    <span class="op">.</span><span class="fu">list</span><span class="op">();</span></span></code></pre></div>
    </div>
</article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
    <ul class="col-sm-6 list-inline">
        <li class="list-inline-item"><a href="https://sengopal.github.io/#">Resume</a></li>
        <li class="list-inline-item"><a href="https://sengopal.github.io/archives">Archives</a></li>
        <li class="list-inline-item"><a href="https://sengopal.github.io/categories">Categories</a></li>
        <li class="list-inline-item"><a href="https://sengopal.github.io/tags">Tags</a></li>
    </ul>
    <p class="col-sm-6 text-sm-right text-muted">
        Opinions my own. Made with &#x2764; using <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a> / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>        
    </p>
</div>    </div>
  </footer>

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" crossorigin="anonymous"></script>
</body>

</html>