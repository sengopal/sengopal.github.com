<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Java Mail Made Easy using Velocity Templates | Senthilkumar Gopal
</title>
  <link rel="canonical" href="https://sengopal.github.io/posts/java-mail-made-easy-using-velocity-templates.html">

    <link rel="apple-touch-icon" href="https://sengopal.github.io/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" type="image/png" href="https://sengopal.github.io/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://sengopal.github.io/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="https://sengopal.github.io/manifest.json">
    <meta name="theme-color" content="#333333">

  <link rel="stylesheet" href="https://sengopal.github.io/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://sengopal.github.io/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="https://sengopal.github.io/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://sengopal.github.io/theme/css/theme.css">
  <link rel="stylesheet" href="https://sengopal.github.io/extras/css/custom.css">
  <link rel="stylesheet" href="https://sengopal.github.io/extras/css/skylighting-solarized-theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://sengopal.github.io/feeds/all.atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://sengopal.github.io/feeds/java.atom.xml">
<meta name="description" content="For an emailing solution we used velocity templates for simpler generation of Java mail templates and data. This post explains the code and the setup to get this in simple steps.">
  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o);
      a.async = 1;
      a.src = g;
      m = s.getElementsByTagName(o)[0];
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-67843911-1', 'auto');
    ga('send', 'pageview');
  </script>


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
  <div class="col-sm-12">
    <h1 class="title"><a href="https://sengopal.github.io/">Senthilkumar Gopal</a></h1>
      <p class="text-muted">Musings of a machine learning researcher, engineer and leader</p>
      <ul class="list-inline">
            <li class="list-inline-item"><a href="https://sengopal.github.io/pages/about.html">About me</a></li>
            <li class="list-inline-item"><a href="https://sengopal.github.io/pages/publications.html">Publications</a></li>
            <li class="list-inline-item"><a href="https://sengopal.github.io/pages/software.html">Software</a></li>
            <li class="list-inline-item"><a href="https://sengopal.github.io/pages/talks.html">Talks</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fas fa-rss" href="https://sengopal.github.io/feeds/all.atom.xml" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-github" href="https://github.com/sengopal" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-speaker-deck" href="https://speakerdeck.com/sengopal" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-medium" href="https://medium.com/@sengopal" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-twitter" href="https://twitter.com/@sengopal" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-linkedin" href="https://www.linkedin.com/in/senthilkumargopal" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>    Java Mail Made Easy using Velocity Templates
</h1>
      <hr>
<article class="article">
    <header>
        <ul class="list-inline">
            <li class="list-inline-item text-muted" title="2010-10-01T00:00:00-07:00">
                <i class="fas fa-clock"></i>
                Fri 01 October 2010
            </li>
            <li class="list-inline-item">
                <i class="fas fa-folder-open"></i>
                <a href="https://sengopal.github.io/category/java.html">Java</a>
            </li>
            <li class="list-inline-item">
                <i class="fas fa-tag"></i>
                <a href="https://sengopal.github.io/tag/javamail.html">#javamail</a>,                 <a href="https://sengopal.github.io/tag/java.html">#java</a>,                 <a href="https://sengopal.github.io/tag/velocity.html">#velocity</a>            </li>
        </ul>
    </header>
    <div class="hidden-xs hidden-sm">
        <nav class="toc" role="doc-toc">
<ul>
<li><a href="#introduction-to-velocity" id="toc-introduction-to-velocity">Introduction to Velocity</a></li>
<li><a href="#simple-velocity-template-example" id="toc-simple-velocity-template-example">Simple Velocity Template
Example</a></li>
<li><a href="#introduction-to-java-mail-api" id="toc-introduction-to-java-mail-api">Introduction to JAVA MAIL
API</a></li>
<li><a href="#project-usage" id="toc-project-usage">Project
Usage</a></li>
<li><a href="#step-by-step-explanation-of-the-code" id="toc-step-by-step-explanation-of-the-code">Step-by-Step Explanation
of the Code</a>
<ul>
<li><a href="#sendmessage.java" id="toc-sendmessage.java">SendMessage.java</a></li>
<li><a href="#advantages" id="toc-advantages">Advantages</a></li>
</ul></li>
</ul>
</nav>
    </div>
    <div class="content">
        <h3 id="introduction-to-velocity">Introduction to Velocity</h3>
<p>Velocity is an open source templating tool developed by an
international volunteer community and hosted by the Apache Software
Foundation’s Jakarta Project. You can download the freely available
source code at the <a href="http://www.javaworld.com/javaworld/jw-12-2001/jw-1228-velocity.html#resources">Jakarta
Velocity</a> Project Website.</p>
<h3 id="simple-velocity-template-example">Simple Velocity Template
Example</h3>
<p>Any application using Velocity requires two parts. The first is the
template</p>
<p><strong>Helloworld.vm</strong></p>
<pre><code>  Hello $name!  Welcome to Velocity!</code></pre>
<p><strong>HelloWorld.java:</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a aria-hidden="true" href="#cb2-1" tabindex="-1"></a>      <span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">StringWriter</span><span class="op">;</span></span>
<span id="cb2-2"><a aria-hidden="true" href="#cb2-2" tabindex="-1"></a>      <span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">velocity</span><span class="op">.</span><span class="im">Template</span><span class="op">;</span></span>
<span id="cb2-3"><a aria-hidden="true" href="#cb2-3" tabindex="-1"></a>      <span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">velocity</span><span class="op">.</span><span class="im">VelocityContext</span><span class="op">;</span></span>
<span id="cb2-4"><a aria-hidden="true" href="#cb2-4" tabindex="-1"></a>      <span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">velocity</span><span class="op">.</span><span class="im">app</span><span class="op">.</span><span class="im">Velocity</span><span class="op">;</span></span>
<span id="cb2-5"><a aria-hidden="true" href="#cb2-5" tabindex="-1"></a>      </span>
<span id="cb2-6"><a aria-hidden="true" href="#cb2-6" tabindex="-1"></a>      <span class="kw">public</span> <span class="kw">class</span> HelloWorld<span class="op">{</span></span>
<span id="cb2-7"><a aria-hidden="true" href="#cb2-7" tabindex="-1"></a>          <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span> <span class="bu">String</span><span class="op">[]</span> args <span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb2-8"><a aria-hidden="true" href="#cb2-8" tabindex="-1"></a>              <span class="co">/*  Get the Template  */</span></span>
<span id="cb2-9"><a aria-hidden="true" href="#cb2-9" tabindex="-1"></a>              Template t <span class="op">=</span> Velocity<span class="op">.</span><span class="fu">getTemplate</span><span class="op">(</span><span class="st">"Helloworld.vm"</span> <span class="op">);</span></span>
<span id="cb2-10"><a aria-hidden="true" href="#cb2-10" tabindex="-1"></a>              <span class="co">/*  create a context and add data */</span></span>
<span id="cb2-11"><a aria-hidden="true" href="#cb2-11" tabindex="-1"></a>              VelocityContext context <span class="op">=</span> <span class="kw">new</span> <span class="fu">VelocityContext</span><span class="op">();</span></span>
<span id="cb2-12"><a aria-hidden="true" href="#cb2-12" tabindex="-1"></a>              context<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">"name"</span><span class="op">,</span> <span class="st">"World"</span><span class="op">);</span></span>
<span id="cb2-13"><a aria-hidden="true" href="#cb2-13" tabindex="-1"></a>              <span class="co">/* now render the template into a StringWriter */</span></span>
<span id="cb2-14"><a aria-hidden="true" href="#cb2-14" tabindex="-1"></a>              <span class="bu">StringWriter</span> writer <span class="op">=</span> <span class="kw">new</span> <span class="bu">StringWriter</span><span class="op">();</span></span>
<span id="cb2-15"><a aria-hidden="true" href="#cb2-15" tabindex="-1"></a>              t<span class="op">.</span><span class="fu">merge</span><span class="op">(</span> context<span class="op">,</span> writer <span class="op">);</span></span>
<span id="cb2-16"><a aria-hidden="true" href="#cb2-16" tabindex="-1"></a>              <span class="co">/* show the World */</span></span>
<span id="cb2-17"><a aria-hidden="true" href="#cb2-17" tabindex="-1"></a>              <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span> writer<span class="op">.</span><span class="fu">toString</span><span class="op">()</span> <span class="op">);</span></span>
<span id="cb2-18"><a aria-hidden="true" href="#cb2-18" tabindex="-1"></a>          <span class="op">}</span></span>
<span id="cb2-19"><a aria-hidden="true" href="#cb2-19" tabindex="-1"></a>      <span class="op">}</span></span></code></pre></div>
<p><strong>Output</strong></p>
<pre><code>  Hello World!  Welcome to Velocity!</code></pre>
<h3 id="introduction-to-java-mail-api">Introduction to JAVA MAIL
API</h3>
<p>The Java Mail API provides the capability to develop email clients
and mail-enabled Java applications. It supports the creation of
sophisticated user interfaces for mail clients. It includes appropriate
convenience classes, which encapsulate common mail functions and
protocols. It fits with other packages for the Java platform in order to
facilitate its use with other Java APIs. It provides a mail and
messaging framework addition to the Java platform.</p>
<p>Although the Java Mail API contains many more classes than those
discussed here, concentrating on some of the core classes to start with
makes it easy to understand the essence of the API. The following is a
brief description of the core classes:</p>
<h4 id="javax.mail.session">javax.mail.Session</h4>
<p>The javax.mail.Session class is the top-level entry class for the
Java Mail API, and its most commonly used methods provide the ability to
control and load the classes that represent the service provider
implementations (SPI) for various mail protocols (Note: A service
provider is a developer and/or vendor that provides an implementation
for an API; examples of Java Mail API implementations include POP3,
SMTP, and IMAP4 – some are available from Sun, others via third
parties.)</p>
<h4 id="javax.mail.transport">javax.mail.Transport</h4>
<p>The javax.mail.Transport class is another provider-implemented class
and is used for sending a message over a specific protocol.</p>
<h4 id="javax.mail.message">javax.mail.Message</h4>
<p>The javax.mail.Message class is implemented by a provider and models
all the details of an actual e-mail message, such as the subject line,
sender/recipient e-mail address, sent date, and so on. The guidelines
for providers who implement the javax.mail.Message dictate that the
actual fetching of e-mail message components should be delayed as long
as possible in order to make this class as lightweight as possible.</p>
<h4 id="simple-java-mail-example">Simple JAVA Mail Example</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a aria-hidden="true" href="#cb4-1" tabindex="-1"></a>      <span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">beans</span><span class="op">.*;</span></span>
<span id="cb4-2"><a aria-hidden="true" href="#cb4-2" tabindex="-1"></a>      <span class="kw">import</span> <span class="im">javax</span><span class="op">.</span><span class="im">mail</span><span class="op">.*;</span></span>
<span id="cb4-3"><a aria-hidden="true" href="#cb4-3" tabindex="-1"></a>      <span class="kw">import</span> <span class="im">javax</span><span class="op">.</span><span class="im">mail</span><span class="op">.</span><span class="im">internet</span><span class="op">.*;</span></span>
<span id="cb4-4"><a aria-hidden="true" href="#cb4-4" tabindex="-1"></a>      <span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.*;</span></span>
<span id="cb4-5"><a aria-hidden="true" href="#cb4-5" tabindex="-1"></a>      <span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">util</span><span class="op">.*;</span></span>
<span id="cb4-6"><a aria-hidden="true" href="#cb4-6" tabindex="-1"></a>       <span class="kw">public</span> <span class="kw">class</span> MailBean <span class="op">{</span></span>
<span id="cb4-7"><a aria-hidden="true" href="#cb4-7" tabindex="-1"></a>            <span class="kw">public</span> <span class="fu">MailBean</span><span class="op">(</span><span class="bu">String</span> from<span class="op">,</span> <span class="bu">String</span> userName<span class="op">,</span> <span class="bu">String</span> subject<span class="op">,</span> <span class="bu">String</span> content<span class="op">){</span></span>
<span id="cb4-8"><a aria-hidden="true" href="#cb4-8" tabindex="-1"></a>               <span class="cf">try</span><span class="op">{</span></span>
<span id="cb4-9"><a aria-hidden="true" href="#cb4-9" tabindex="-1"></a>                  <span class="fu">mail</span><span class="op">(</span>from<span class="op">,</span> userName<span class="op">,</span> subject<span class="op">,</span> content<span class="op">);</span></span>
<span id="cb4-10"><a aria-hidden="true" href="#cb4-10" tabindex="-1"></a>               <span class="op">}</span><span class="cf">catch</span><span class="op">(</span>MessagingException e<span class="op">)</span>  <span class="op">{}</span></span>
<span id="cb4-11"><a aria-hidden="true" href="#cb4-11" tabindex="-1"></a>             <span class="op">}</span></span>
<span id="cb4-12"><a aria-hidden="true" href="#cb4-12" tabindex="-1"></a>             <span class="kw">public</span> <span class="bu">String</span> <span class="fu">getBenaInfo</span><span class="op">(){</span></span>
<span id="cb4-13"><a aria-hidden="true" href="#cb4-13" tabindex="-1"></a>                  <span class="cf">return</span> <span class="st">"A Bean that sends mail"</span><span class="op">;</span></span>
<span id="cb4-14"><a aria-hidden="true" href="#cb4-14" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb4-15"><a aria-hidden="true" href="#cb4-15" tabindex="-1"></a>           <span class="kw">public</span> <span class="dt">void</span> <span class="fu">mail</span><span class="op">(</span><span class="bu">String</span> from<span class="op">,</span> <span class="bu">String</span> userName<span class="op">,</span> <span class="bu">String</span> subject<span class="op">,</span> <span class="bu">String</span> content<span class="op">)</span><span class="kw">throws</span> MessagingException<span class="op">{</span></span>
<span id="cb4-16"><a aria-hidden="true" href="#cb4-16" tabindex="-1"></a>              <span class="bu">String</span> smtpHost <span class="op">=</span> <span class="st">"00.00.00.00"</span><span class="op">;</span></span>
<span id="cb4-17"><a aria-hidden="true" href="#cb4-17" tabindex="-1"></a>              <span class="co">//start a session</span></span>
<span id="cb4-18"><a aria-hidden="true" href="#cb4-18" tabindex="-1"></a>              java<span class="op">.</span><span class="fu">util</span><span class="op">.</span><span class="fu">Properties</span> properties <span class="op">=</span> <span class="bu">System</span><span class="op">.</span><span class="fu">getProperties</span><span class="op">();</span></span>
<span id="cb4-19"><a aria-hidden="true" href="#cb4-19" tabindex="-1"></a>              properties<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">"mail.smtp.host"</span><span class="op">,</span>smtpHost<span class="op">);</span></span>
<span id="cb4-20"><a aria-hidden="true" href="#cb4-20" tabindex="-1"></a>              Session session <span class="op">=</span> Session<span class="op">.</span><span class="fu">getInstance</span><span class="op">(</span>properties<span class="op">,</span><span class="kw">null</span><span class="op">);</span></span>
<span id="cb4-21"><a aria-hidden="true" href="#cb4-21" tabindex="-1"></a></span>
<span id="cb4-22"><a aria-hidden="true" href="#cb4-22" tabindex="-1"></a>              <span class="co">//Construct a message object</span></span>
<span id="cb4-23"><a aria-hidden="true" href="#cb4-23" tabindex="-1"></a>              MimeMessage message <span class="op">=</span> <span class="kw">new</span> <span class="fu">MimeMessage</span><span class="op">(</span>session<span class="op">);</span></span>
<span id="cb4-24"><a aria-hidden="true" href="#cb4-24" tabindex="-1"></a>              message<span class="op">.</span><span class="fu">setFrom</span><span class="op">(</span><span class="kw">new</span> <span class="fu">InternetAddress</span><span class="op">(</span>from<span class="op">));</span></span>
<span id="cb4-25"><a aria-hidden="true" href="#cb4-25" tabindex="-1"></a>              message<span class="op">.</span><span class="fu">addRecipient</span><span class="op">(</span>Message<span class="op">.</span><span class="fu">RecipientType</span><span class="op">.</span><span class="fu">TO</span><span class="op">,</span><span class="kw">new</span> <span class="fu">InternetAddress</span><span class="op">(</span>userName<span class="op">));</span></span>
<span id="cb4-26"><a aria-hidden="true" href="#cb4-26" tabindex="-1"></a>              message<span class="op">.</span><span class="fu">setSubject</span><span class="op">(</span>subject<span class="op">);</span></span>
<span id="cb4-27"><a aria-hidden="true" href="#cb4-27" tabindex="-1"></a>              message<span class="op">.</span><span class="fu">setText</span><span class="op">(</span>content<span class="op">);</span></span>
<span id="cb4-28"><a aria-hidden="true" href="#cb4-28" tabindex="-1"></a>              message<span class="op">.</span><span class="fu">setSentDate</span><span class="op">(</span><span class="kw">new</span> java<span class="op">.</span><span class="fu">util</span><span class="op">.</span><span class="fu">Date</span><span class="op">());</span></span>
<span id="cb4-29"><a aria-hidden="true" href="#cb4-29" tabindex="-1"></a></span>
<span id="cb4-30"><a aria-hidden="true" href="#cb4-30" tabindex="-1"></a>              <span class="co">//connect to transport</span></span>
<span id="cb4-31"><a aria-hidden="true" href="#cb4-31" tabindex="-1"></a>              Transport transport <span class="op">=</span> session<span class="op">.</span><span class="fu">getTransport</span><span class="op">(</span><span class="st">"smtp"</span><span class="op">);</span></span>
<span id="cb4-32"><a aria-hidden="true" href="#cb4-32" tabindex="-1"></a>              transport<span class="op">.</span><span class="fu">connect</span><span class="op">(</span>smtpHost<span class="op">,</span><span class="st">""</span><span class="op">,</span> <span class="st">""</span><span class="op">);</span></span>
<span id="cb4-33"><a aria-hidden="true" href="#cb4-33" tabindex="-1"></a></span>
<span id="cb4-34"><a aria-hidden="true" href="#cb4-34" tabindex="-1"></a>              <span class="co">//send the message and close the connection</span></span>
<span id="cb4-35"><a aria-hidden="true" href="#cb4-35" tabindex="-1"></a>              transport<span class="op">.</span><span class="fu">sendMessage</span><span class="op">(</span>message<span class="op">,</span>message<span class="op">.</span><span class="fu">getAllRecipients</span><span class="op">());</span></span>
<span id="cb4-36"><a aria-hidden="true" href="#cb4-36" tabindex="-1"></a>              transport<span class="op">.</span><span class="fu">close</span><span class="op">();</span></span>
<span id="cb4-37"><a aria-hidden="true" href="#cb4-37" tabindex="-1"></a>           <span class="op">}</span></span>
<span id="cb4-38"><a aria-hidden="true" href="#cb4-38" tabindex="-1"></a>       <span class="op">}</span></span></code></pre></div>
<p>As there are a lot of tutorials available for Velocity and Java Mail,
this tutorial deals only with the integration of Velocity for easier and
more customized mailing abilities.</p>
<h3 id="project-usage">Project Usage</h3>
<p>Our Project required nearly fifty different mail formats to be sent
on various stages of the application. The difficult part being that the
templates contained loads of dynamic data. Also these templates were
being updated on a regular basis making it more difficult for developing
the application.</p>
<p>We used Velocity Templates for storing the design and the layout of
the mail which needs to be sent and used them for integrating the
dynamic attributes into the layout and hence providing a seamless
abstraction between the presentation and the business layer.</p>
<h2 id="step-by-step-explanation-of-the-code">Step-by-Step Explanation
of the Code</h2>
<h3 id="sendmessage.java">SendMessage.java</h3>
<p><strong>Velocity Template Merging</strong></p>
<ul>
<li>The best practice for storing the non-variables such as the SMTP
connect parameters, the template names etc., either in a properties file
or in a constants interface. In this example, a properties file, “mail.
properties” has been used. Using the ClassLoader the properties file is
loaded</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a aria-hidden="true" href="#cb5-1" tabindex="-1"></a>          <span class="bu">Properties</span> props <span class="op">=</span> <span class="kw">new</span> <span class="bu">Properties</span><span class="op">();</span></span>
<span id="cb5-2"><a aria-hidden="true" href="#cb5-2" tabindex="-1"></a>          props<span class="op">.</span><span class="fu">load</span><span class="op">(</span>SendMessage<span class="op">.</span><span class="fu">class</span><span class="op">.</span><span class="fu">getClassLoader</span><span class="op">().</span><span class="fu">getResourceAsStream</span><span class="op">(</span><span class="st">"mail.properties"</span><span class="op">));</span></span></code></pre></div>
<ul>
<li>The Mail.vm template is loaded from into the Velocity context using
the static method Velocity.getTemplate</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a aria-hidden="true" href="#cb6-1" tabindex="-1"></a>          Template template <span class="op">=</span> Velocity<span class="op">.</span><span class="fu">getTemplate</span><span class="op">(</span><span class="st">"Mail.vm"</span><span class="op">);</span></span>
<span id="cb6-2"><a aria-hidden="true" href="#cb6-2" tabindex="-1"></a>          VelocityContext context <span class="op">=</span> <span class="kw">new</span> <span class="fu">VelocityContext</span><span class="op">();</span></span></code></pre></div>
<ul>
<li>Then the user defined MailBean is placed in the velocity Context
under the name “MailBean”</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a aria-hidden="true" href="#cb7-1" tabindex="-1"></a>          context<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">"MailBean"</span> <span class="op">,</span> mailBean<span class="op">);</span></span></code></pre></div>
<ul>
<li>Along with beans, we can place name value pairs directly in the
velocity context</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a aria-hidden="true" href="#cb8-1" tabindex="-1"></a>          <span class="bu">String</span> host <span class="op">=</span>  props<span class="op">.</span><span class="fu">getProperty</span><span class="op">(</span><span class="st">"hostname"</span><span class="op">);</span></span>
<span id="cb8-2"><a aria-hidden="true" href="#cb8-2" tabindex="-1"></a>          context<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">"host"</span><span class="op">,</span> host<span class="op">);</span></span>
<span id="cb8-3"><a aria-hidden="true" href="#cb8-3" tabindex="-1"></a>          context<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">"imgName"</span><span class="op">,</span> <span class="st">"smile.gif"</span><span class="op">);</span></span>
<span id="cb8-4"><a aria-hidden="true" href="#cb8-4" tabindex="-1"></a>          context<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">"context"</span><span class="op">,</span> <span class="st">"myApp"</span><span class="op">);</span></span></code></pre></div>
<ul>
<li>When the context is merged with the template and the results in
placed in a StringWriter Object</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a aria-hidden="true" href="#cb9-1" tabindex="-1"></a>          <span class="bu">StringWriter</span> message <span class="op">=</span> <span class="kw">new</span> <span class="bu">StringWriter</span><span class="op">();</span></span>
<span id="cb9-2"><a aria-hidden="true" href="#cb9-2" tabindex="-1"></a>          template<span class="op">.</span><span class="fu">merge</span><span class="op">(</span>context<span class="op">,</span> message<span class="op">);</span></span></code></pre></div>
<p><strong>JAVA Mail - E-Mail Creation</strong></p>
<ul>
<li>The SMTP Host variable is placed in the System Properties and the
javax.mail.Session is obtained for the given SMTP Host</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb10-1"><a aria-hidden="true" href="#cb10-1" tabindex="-1"></a>          <span class="bu">Properties</span> sysProperties <span class="op">=</span> <span class="bu">System</span><span class="op">.</span><span class="fu">getProperties</span><span class="op">();</span></span>
<span id="cb10-2"><a aria-hidden="true" href="#cb10-2" tabindex="-1"></a>          sysProperties<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">"mail.smtp.host"</span><span class="op">,</span> props<span class="op">.</span><span class="fu">getProperty</span><span class="op">(</span><span class="st">"smtpHost"</span><span class="op">));</span></span>
<span id="cb10-3"><a aria-hidden="true" href="#cb10-3" tabindex="-1"></a>          Session session <span class="op">=</span> Session<span class="op">.</span><span class="fu">getInstance</span><span class="op">(</span>sysProperties<span class="op">,</span> <span class="kw">null</span><span class="op">);</span></span></code></pre></div>
<ul>
<li><p>Since the e-mail needs to contain text and an image file, create
a MimeMultipart with the subtype declared as “related’ so that the image
being put doesnt get lost if the images are blocked by the recipient</p>
<pre><code>    MimeMultipart multipart = new MimeMultipart("related");</code></pre></li>
</ul>
<p><strong>For adding the image to the e-mail</strong></p>
<ul>
<li>Create a body part for storing the image and embedding into the
e-mail</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb12-1"><a aria-hidden="true" href="#cb12-1" tabindex="-1"></a>          BodyPart imageBodyPart <span class="op">=</span> <span class="kw">new</span> <span class="fu">MimeBodyPart</span><span class="op">();</span></span></code></pre></div>
<ul>
<li>Use the FileDataSource to read the image from the Web deployment
folder. Note: <em>Using File.seperator takes care of the Windows/Unix
environment issue</em></li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb13-1"><a aria-hidden="true" href="#cb13-1" tabindex="-1"></a>          <span class="bu">StringBuffer</span> imgPath <span class="op">=</span> <span class="kw">new</span> <span class="bu">StringBuffer</span><span class="op">().</span><span class="fu">append</span><span class="op">(</span><span class="bu">File</span><span class="op">.</span><span class="fu">separator</span><span class="op">).</span><span class="fu">append</span><span class="op">(</span><span class="st">"applications"</span><span class="op">).</span><span class="fu">append</span><span class="op">(</span><span class="bu">File</span><span class="op">.</span><span class="fu">separator</span><span class="op">).</span><span class="fu">append</span><span class="op">(</span><span class="st">"mailheader.GIF"</span><span class="op">);</span></span></code></pre></div>
<ul>
<li>Then using the DataHandler object place the image into the BodyPart
created</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a aria-hidden="true" href="#cb14-1" tabindex="-1"></a>          <span class="bu">DataSource</span> fds <span class="op">=</span> <span class="kw">new</span> <span class="bu">FileDataSource</span><span class="op">(</span>imgPath<span class="op">.</span><span class="fu">toString</span><span class="op">());</span></span>
<span id="cb14-2"><a aria-hidden="true" href="#cb14-2" tabindex="-1"></a>          imageBodyPart<span class="op">.</span><span class="fu">setDataHandler</span><span class="op">(</span><span class="kw">new</span> <span class="bu">DataHandler</span><span class="op">(</span>fds<span class="op">));</span></span></code></pre></div>
<ul>
<li>Set an id for the image body part so that the image can be accessed
anywhere in the mail for embedding</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb15-1"><a aria-hidden="true" href="#cb15-1" tabindex="-1"></a>          imageBodyPart<span class="op">.</span><span class="fu">setHeader</span><span class="op">(</span><span class="st">"Content-ID"</span><span class="op">,</span><span class="st">"&lt;123&gt;"</span><span class="op">);</span></span></code></pre></div>
<ul>
<li>Add the Image Body Part into the MimeMultiPart object</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb16-1"><a aria-hidden="true" href="#cb16-1" tabindex="-1"></a>          multipart<span class="op">.</span><span class="fu">addBodyPart</span><span class="op">(</span>imageBodyPart<span class="op">);</span></span></code></pre></div>
<p><strong>Adding the Message body content to the e-mail</strong></p>
<ul>
<li>Create a body part for storing the message content in the
e-mail</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb17-1"><a aria-hidden="true" href="#cb17-1" tabindex="-1"></a>          BodyPart messageBodyPart <span class="op">=</span> <span class="kw">new</span> <span class="fu">MimeBodyPart</span><span class="op">();</span></span></code></pre></div>
<ul>
<li>Combine the StringWriter Object and the image src code using a
StringBuffer</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb18-1"><a aria-hidden="true" href="#cb18-1" tabindex="-1"></a>          <span class="bu">StringBuffer</span> messageBuffer <span class="op">=</span> <span class="kw">new</span> <span class="bu">StringBuffer</span><span class="op">();</span></span>
<span id="cb18-2"><a aria-hidden="true" href="#cb18-2" tabindex="-1"></a>          messageBuffer<span class="op">.</span><span class="fu">append</span><span class="op">(</span>message<span class="op">.</span><span class="fu">toString</span><span class="op">());</span></span>
<span id="cb18-3"><a aria-hidden="true" href="#cb18-3" tabindex="-1"></a>          messageBuffer<span class="op">.</span><span class="fu">append</span><span class="op">(</span><span class="st">"&lt;img src="</span>cid<span class="op">:</span><span class="dv">123</span>\<span class="st">"&gt;"</span><span class="op">);</span></span></code></pre></div>
<ul>
<li>Set the Message content type as <em>text/html</em>, since our
template VM is designed using HTML and add the message body part to the
main MultiMime part</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb19-1"><a aria-hidden="true" href="#cb19-1" tabindex="-1"></a>          messageBodyPart<span class="op">.</span><span class="fu">setContent</span><span class="op">(</span>messageBuffer<span class="op">.</span><span class="fu">toString</span><span class="op">(),</span> <span class="st">"text/html"</span><span class="op">);</span></span>
<span id="cb19-2"><a aria-hidden="true" href="#cb19-2" tabindex="-1"></a>          multipart<span class="op">.</span><span class="fu">addBodyPart</span><span class="op">(</span>messageBodyPart<span class="op">);</span></span></code></pre></div>
<p><strong>Sending the E-Mail</strong></p>
<ul>
<li>Create a MimeMessage using the javax.mail.Session Object</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb20-1"><a aria-hidden="true" href="#cb20-1" tabindex="-1"></a>          Message msg <span class="op">=</span> <span class="kw">new</span> <span class="fu">MimeMessage</span><span class="op">(</span>session<span class="op">);</span></span></code></pre></div>
<ul>
<li>Set the content as the multimime part object created</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb21-1"><a aria-hidden="true" href="#cb21-1" tabindex="-1"></a>          msg<span class="op">.</span><span class="fu">setContent</span><span class="op">(</span>multipart<span class="op">);</span></span></code></pre></div>
<ul>
<li>The Recipients are added to the e-mail for the recipient types TO,
CC and BCC</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb22-1"><a aria-hidden="true" href="#cb22-1" tabindex="-1"></a>          msg<span class="op">.</span><span class="fu">addRecipients</span><span class="op">(</span>Message<span class="op">.</span><span class="fu">RecipientType</span><span class="op">.</span><span class="fu">TO</span><span class="op">,</span> InternetAddress<span class="op">.</span><span class="fu">parse</span><span class="op">(</span><span class="st">"someone@example.com"</span><span class="op">));</span></span>
<span id="cb22-2"><a aria-hidden="true" href="#cb22-2" tabindex="-1"></a>          msg<span class="op">.</span><span class="fu">addRecipients</span><span class="op">(</span>Message<span class="op">.</span><span class="fu">RecipientType</span><span class="op">.</span><span class="fu">CC</span><span class="op">,</span>InternetAddress<span class="op">.</span><span class="fu">parse</span><span class="op">(</span><span class="st">"everyone@example.com"</span><span class="op">));</span></span>
<span id="cb22-3"><a aria-hidden="true" href="#cb22-3" tabindex="-1"></a>          <span class="cf">if</span><span class="op">((</span><span class="kw">null</span><span class="op">!=</span>recipientsList<span class="op">)&amp;&amp;(!</span>recipientsList<span class="op">.</span><span class="fu">isEmpty</span><span class="op">())){</span></span>
<span id="cb22-4"><a aria-hidden="true" href="#cb22-4" tabindex="-1"></a>              <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>recipientsList<span class="op">.</span><span class="fu">size</span><span class="op">();</span>i<span class="op">++){</span></span>
<span id="cb22-5"><a aria-hidden="true" href="#cb22-5" tabindex="-1"></a>                  msg<span class="op">.</span><span class="fu">addRecipients</span><span class="op">(</span>Message<span class="op">.</span><span class="fu">RecipientType</span><span class="op">.</span><span class="fu">BCC</span><span class="op">,</span>InternetAddress<span class="op">.</span><span class="fu">parse</span><span class="op">(</span>recipientsList<span class="op">.</span><span class="fu">get</span><span class="op">(</span>i<span class="op">)));</span></span>
<span id="cb22-6"><a aria-hidden="true" href="#cb22-6" tabindex="-1"></a>              <span class="op">}</span></span>
<span id="cb22-7"><a aria-hidden="true" href="#cb22-7" tabindex="-1"></a>          <span class="op">}</span></span></code></pre></div>
<ul>
<li>The Subject Text, Sent Date and the From Address are set as
below.</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb23-1"><a aria-hidden="true" href="#cb23-1" tabindex="-1"></a>          msg<span class="op">.</span><span class="fu">setSubject</span><span class="op">(</span>subject<span class="op">);</span></span>
<span id="cb23-2"><a aria-hidden="true" href="#cb23-2" tabindex="-1"></a>          msg<span class="op">.</span><span class="fu">setSentDate</span><span class="op">(</span><span class="kw">new</span> <span class="bu">Date</span><span class="op">());</span></span>
<span id="cb23-3"><a aria-hidden="true" href="#cb23-3" tabindex="-1"></a>          msg<span class="op">.</span><span class="fu">setFrom</span><span class="op">(</span><span class="kw">new</span> <span class="fu">InternetAddress</span><span class="op">(</span><span class="st">"dummy@example.com"</span><span class="op">));</span></span></code></pre></div>
<ul>
<li>The Transport Object is used for creating the connection to the SMTP
host and sending the e-mail. The transporter object below is obtained
using the getTransport method and by giving the parameter as
<em>smtp</em> as the protocol for the Transport Object</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb24-1"><a aria-hidden="true" href="#cb24-1" tabindex="-1"></a>          Transport transport <span class="op">=</span> session<span class="op">.</span><span class="fu">getTransport</span><span class="op">(</span><span class="st">"smtp"</span><span class="op">);</span></span></code></pre></div>
<ul>
<li>Then the Transport is connected using the HOST, UserName and
Password parameters from the properties file</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb25-1"><a aria-hidden="true" href="#cb25-1" tabindex="-1"></a>          transport<span class="op">.</span><span class="fu">connect</span><span class="op">(</span>props<span class="op">.</span><span class="fu">getProperty</span><span class="op">(</span><span class="st">"connectHost"</span><span class="op">);</span></span>
<span id="cb25-2"><a aria-hidden="true" href="#cb25-2" tabindex="-1"></a>          props<span class="op">.</span><span class="fu">getProperty</span><span class="op">(</span><span class="st">"connectUser"</span><span class="op">);</span></span>
<span id="cb25-3"><a aria-hidden="true" href="#cb25-3" tabindex="-1"></a>          props<span class="op">.</span><span class="fu">getProperty</span><span class="op">(</span><span class="st">"connectPassword"</span><span class="op">);</span></span></code></pre></div>
<ul>
<li>Then the e-mail is sent using the sendMessage to all the
recipients</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb26-1"><a aria-hidden="true" href="#cb26-1" tabindex="-1"></a>          transport<span class="op">.</span><span class="fu">sendMessage</span><span class="op">(</span>msg<span class="op">,</span>msg<span class="op">.</span><span class="fu">getAllRecipients</span><span class="op">());</span></span></code></pre></div>
<ul>
<li>The transport is closed to mark the end of the connection</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb27-1"><a aria-hidden="true" href="#cb27-1" tabindex="-1"></a>          transport<span class="op">.</span><span class="fu">close</span><span class="op">();</span></span></code></pre></div>
<h4 id="mail.vm">Mail.vm</h4>
<p><strong>Image Path Macro</strong></p>
<p>This macro is used to return the path to be used as SRC by the images
in the HTML. It takes a parameter imgName and returns the string,</p>
<pre><code>  https://$host/$context/images/$imgName</code></pre>
<p>where $host, $context are context variables placed by the JAVA
code</p>
<p>The macro looks like this</p>
<pre><code>  #macro( IMGURL $imgName )
      https://$host/$context/images/$imgName
  #end</code></pre>
<p>Example:</p>
<pre><code>  &lt;img src="#IMGURL('mailheader.GIF')" border="0" width="980" height="61"&gt;</code></pre>
<p>This will get generated as:</p>
<pre><code>  &lt;img src="https://localhost/myapp/images/mailheader.GIF" border="0" width="980" height="61"&gt;</code></pre>
<p><strong>Accessing the Bean Object</strong></p>
<p>The variables in the MailBean object placed in the context can be
accessed using, <code>$MailBean.\[variable-name\]</code> Example:
<code>Mail Content : $MailBean.content</code></p>
<h4 id="mail.properties">mail.properties</h4>
<p>This file contains the connection and the other context parameter
properties used by the java code</p>
<h3 id="advantages">Advantages</h3>
<p>Designed as an easy-to-use general templating tool, Velocity is
useful in any Java application area that requires data formatting and
presentation. Their salient advantages being:</p>
<ul>
<li>It adapts to many application areas.</li>
<li>It offers a simple, clear syntax for the template designer.</li>
<li>It offers a simple programming model for the developer.</li>
<li>Because templates and code are separate, you can develop and
maintain them independently.</li>
<li>The Velocity engine easily integrates into any Java application
environment, especially Servlets.</li>
<li>Velocity enables templates to access any public method of data
objects in the context.</li>
</ul>
<h4 id="references">References</h4>
<ul>
<li><a class="uri" href="http://velocity.apache.org/">http://velocity.apache.org/</a></li>
<li><a class="uri" href="http://www.roseindia.net/software-tutorials/detail/3131">http://www.roseindia.net/software-tutorials/detail/3131</a></li>
<li><a class="uri" href="http://java.sun.com/developer/">http://java.sun.com/developer/</a></li>
<li><a class="uri" href="http://kickjava.com/2876.htm">http://kickjava.com/2876.htm</a></li>
<li><a class="uri" href="http://www.javaworld.com/javaworld/jw-12-2001/jw-1228-velocity.html">http://www.javaworld.com/javaworld/jw-12-2001/jw-1228-velocity.html</a></li>
<li><a class="uri" href="http://velocity.apache.org/engine/releases/velocity-1.5/user-guide.html">http://velocity.apache.org/engine/releases/velocity-1.5/user-guide.html</a></li>
<li><a class="uri" href="http://www.javasoft.com/products/javamail">http://www.javasoft.com/products/javamail</a></li>
</ul>
    </div>
</article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
    <ul class="col-sm-6 list-inline">
        <li class="list-inline-item"><a href="https://sengopal.github.io/#">Resume</a></li>
        <li class="list-inline-item"><a href="https://sengopal.github.io/archives">Archives</a></li>
        <li class="list-inline-item"><a href="https://sengopal.github.io/categories">Categories</a></li>
        <li class="list-inline-item"><a href="https://sengopal.github.io/tags">Tags</a></li>
    </ul>
    <p class="col-sm-6 text-sm-right text-muted">
        Opinions my own. Made with &#x2764; using <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a> / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>        
    </p>
</div>    </div>
  </footer>

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" crossorigin="anonymous"></script>
</body>

</html>